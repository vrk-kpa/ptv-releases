@using System.Security.Claims;
@using Microsoft.AspNetCore.Identity;
@using PTV.Database.DataAccess.Interfaces.Services;
@using System.Globalization;
@using Microsoft.AspNetCore.Mvc.Localization;
@using PTV.Database.DataAccess.Interfaces.Services.Security
@using PTV.Domain.Model.Enums.Security
@using PTV.IdentityUserManager
@using PTV.IdentityUserManager.Services
@using PTV.LocalAuthentication

@inject SignInManager<StsUser> SignInManager;
@inject UserManager<StsUser> UserManager;
@inject IUserService userService;
@inject IViewLocalizer Localizer

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@Localizer["sts_ServiceName"]</title>
    <link rel="icon" type="image/x-icon" href="~/favicon.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="~/favicon.ico" />
    <link rel="stylesheet" href="~/css/Layout.css" />
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/listbox.css" />
</head>
<body>
    <div id="login-page">
        <nav id="login-header" class="navbar navbar-dark bg-inverse ptv-navbar">
            <div class="container nav-main">

                @if (!string.IsNullOrEmpty(Startup.EnvironmentName))
            {
                    <div class="header-center">
                        <div class="header-center-text">
                            @Localizer.GetString("sts_Environment" + Startup.EnvironmentName)
                        </div>
                    </div>
                }

                <div class="clearfix">
                    <div class="logo-placeholder">
                        <a href="#">
                            <img viewBox="0 0 300 47" width="300" height="47" src="~/img/logo.svg" />
                        </a>
                    </div>
                    <div class="header-languages">
                        <div id="navbar" class="navbar-collapse">
                            <ul class="nav navbar-nav">
                                <li>
                                    <a href="@Url.Action("SetLanguage", "Language", new { @culture = "fi-FI" })" class='@(CultureInfo.CurrentCulture.Name == "fi-FI" ? "active" : "")'>SUOMEKSI</a>
                                </li>
                                <li>
                                    <a href="@Url.Action("SetLanguage", "Language", new { @culture = "sv-SE" })" class='@(CultureInfo.CurrentCulture.Name == "sv-SE" ? "active" : "")'>PÅ SVENSKA</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
            
            @if (SignInManager.IsSignedIn(User))
            {
                <div class="site-navigation">
                    <nav class="navbar">
                        <div class="container">
                            <div id="navbar" class="navbar-collapse">
                                <ul class="nav navbar-nav">           
                                    <li class="nav-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
                                    @if (User.HasRole(UserRoleEnum.Eeva) || (User.HasRole(UserRoleEnum.Pete) && userService.IsUserAssignedToOrganization(User.Identity.Name)))
                                    {
                                        <li class="nav-item active"><a asp-controller="Account" asp-action="Register">Register new user</a></li>
                                        <li class="nav-item active"><a asp-controller="Account" asp-action="ResetPasswordForUser">Reset Password for User</a></li>
                                    }
                                    @if (User.HasRole(UserRoleEnum.Eeva))
                                    {
@*                                        <li class="nav-item active"><a asp-controller="Manage" asp-action="AddClient">Add a Client</a></li>*@
@*                                        <li class="nav-item active"><a asp-controller="Manage" asp-action="AddScope">Add Scope</a></li>*@
                                        <li class="nav-item active"><a asp-controller="Account" asp-action="ListUsers">List of Users</a></li>
                                    }
                                    @if (User.HasRole(UserRoleEnum.Eeva) || (User.HasRole(UserRoleEnum.Pete) && userService.IsUserAssignedToOrganization(User.Identity.Name)))
                                    {
                                        <li class="nav-item active"><a asp-controller="Account" asp-action="ChangeUserInfo">Change UserInfo</a></li>
                                    }
                                    @if (User.HasRole(UserRoleEnum.Eeva))
                                    { 
                                        <li class="nav-item active"><a asp-controller="Account" asp-action="SetUserAccessRights">Set Access rights to User</a></li>
                                    }
                                    <li class="nav-item"><a asp-controller="Account" asp-action="ChangePassword">Change Password</a></li>
                                    <li class="nav-item"><a asp-controller="Account" asp-action="LogOff">Log off</a></li>
                                </ul>
                            </div>
                        </div>
                    </nav>
                </div>
            }

        </nav>

        <div class="container">
            @RenderBody()
        </div>
        <footer id="login-footer" class="navbar navbar-dark bg-inverse ptv-navbar">
            <div class="container">
                <div class="row">
                    <div class="col-xs-12 col-md-6 col-lg-4">
                        <ul class="link-list">
                            <li>
                                <p class="text-uppercase">@Localizer["sts_ServiceName"]</p>
                            </li>
                            <li>
                                <p>@Localizer["sts_FooterServiceProviderDescription"] <a target="_blank" lang="fi" href=@Localizer["sts_FooterServiceProviderLink"]>@Localizer["sts_FooterServiceProvider"]</a></p>
                            </li>
                            <li>
                                <a target="_blank" lang="fi" href=@Localizer["sts_FooterPrivacyPolicyLink"]>@Localizer["sts_FooterPrivacyPolicy"]</a>
                            </li>
                        </ul>
                </div>
                    <div class="col-xs-12 col-md-6 col-lg-4">
                        <ul class="link-list">
                            <li>
                                <a target="_blank" lang="fi" href=@Localizer["sts_FooterFeedbackLink"]>@Localizer["sts_FooterFeedback"]</a>
                            </li>
                            <li>
                                <a target="_blank" lang="fi" href=@Localizer["sts_FooterAboutServiceLink"]>@Localizer["sts_FooterAboutService"]</a>
                            </li>
                            <li>
                                <p>@Localizer["sts_FooterSourceCodeDescription"] <a target="_blank" lang="fi" href=@Localizer["sts_FooterSourceCodeLink"]>@Localizer["sts_FooterSourceCode"]</a></p>
                            </li>
                        </ul>
                    </div>
                    <div class="col-xs-12 col-md-6 col-md-offset-6 col-lg-offset-0 col-lg-4">
                        <ul class="link-list">
                            <li>
                                <a target="_blank" lang="fi" href=@Localizer["sts_FooterPublicWebLink"]>@Localizer["sts_FooterPublicWeb"]</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    <script src="~/lib/tether/dist/js/tether.js"></script>
    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
    <script src="~/lib/bootstrap/dist/js/listbox.js"></script>
    @RenderSection("scripts", required: false)
</body>





</html>
